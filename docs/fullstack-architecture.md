# Fullstack Architecture Document: Sistema de Avaliação de Saúde Escolar

## 1. High Level Architecture

*   **Resumo Técnico:** Arquitetura Jamstack com Serverless Functions baseada em um monorepo contendo uma aplicação SvelteKit. Hospedagem na Vercel, banco de dados Neon PostgreSQL e autenticação via Google OAuth.
*   **Diagrama da Arquitetura:** (Inclui o diagrama Mermaid da arquitetura, conforme gerado anteriormente)

## 2. Tech Stack

(Inclui a tabela completa da Stack de Tecnologia, conforme gerada anteriormente)

## Seção 3: Data Models (Versão 3.0 - Corrigida)
Decisão de Arquitetura - Chaves Primárias: Todas as chaves primárias (id) serão do tipo INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY no banco de dados PostgreSQL. Consequentemente, em todas as interfaces TypeScript, o tipo do id será number.
**1. Aluno**
```typescript
interface Aluno {
id: number; // Integer Primary Key
nomeCompleto: string;
dataNascimento: Date;
sexo: 'Masculino' | 'Feminino';
cpf?: string;
nis?: string;
}
```

**2. Turma**
```typescript
interface Turma {
  id: number; // Integer Primary Key
  anoLetivo: number;
  nome: string;
  periodo: 'Manhã' | 'Tarde' | 'Integral' | 'Noite';
  escolaId: number; // Foreign Key
}
```

**3. Matricula**
```typescript
interface Matricula {
  id: number; // Integer Primary Key
  alunoId: number; // Foreign Key
  turmaId: number; // Foreign Key
}
```
**4. Avaliacao (O "Evento" ou "Atendimento" Mestre)**
```typescript
interface Avaliacao {
  id: number;
  matriculaId: number;
  avaliadorId: number;
  dataAvaliacao: Date;
  alunoAusente: boolean;
  // Chaves estrangeiras opcionais para os resultados específicos.
  // Um único evento de Avaliação pode ter um ou mais tipos de resultados.
  avaliacaoVisualId?: number;
  avaliacaoAntropometricaId?: number;
  avaliacaoOdontologicaId?: number;
}
  id: number;
  matriculaId: number;
  avaliadorId: number;
  dataAvaliacao: Date;
  alunoAusente: boolean;
  // Chaves estrangeiras opcionais para os resultados específicos.
  // Um único evento de Avaliação pode ter um ou mais tipos de resultados.
  avaliacaoVisualId?: number;
  avaliacaoAntropometricaId?: number;
  avaliacaoOdontologicaId?: number;
}
```

**5. AvaliacaoVisual (Resultados Específicos da Visão)**
```typescript
interface AvaliacaoVisual {
  id: number;
  olhoDireito: number;
  olhoEsquerdo: number;
  reteste?: number; // Resultado unificado dos dois olhos
}
```

**6. AvaliacaoAntropometrica (Resultados Específicos da Antropometria)**
```typescript
interface AvaliacaoAntropometrica {
  id: number;
  pesoKg: number;
  alturaCm: number;
  classificacaoCDC?: string; // Armazenado opcionalmente para performance
}
```
**7. AvaliacaoOdontologica (Resultados Específicos de Odonto)**
```typescript
interface AvaliacaoOdontologica {
  id: number;
  risco: string;
  atfRealizado: boolean;
  necessitaART: boolean;
  artQuantidadeDentes?: number;
  escovacaoOrientadaRealizada: boolean;
}
```


## 4. Unified Project Structure

(Inclui a estrutura de pastas do monorepo, conforme gerada anteriormente)

## 5. Coding Standards

*   **Tipagem Estrita:** TypeScript com `strict` ativado.
*   **Tipos Compartilhados:** Importar de `packages/shared-types`.
*   **Acesso ao Banco de Dados:** Lógica de acesso ao DB deve residir em `src/lib/server/db`.
*   **Variáveis de Ambiente:** Acessar via módulos `$env` do SvelteKit.
*   **Validação:** Toda entrada de dados do cliente deve ser validada no servidor com Zod.